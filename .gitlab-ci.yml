---
image: docker:dind

# Automatically build, validate, and deploy the zookeeper-cdh-docker project

# Build the docker image
verify_build:
  stage: test
  script:
    - chmod +x ${CI_PROJECT_DIR}/build.sh
    - ${CI_PROJECT_DIR}/build.sh

deploy:
  stage: deploy
  only:
    - master
    - tags
  script:
    - chmod +x ${CI_PROJECT_DIR}/build.sh
    - echo "Building the docker images, tagging as '${CI_COMMIT_TAG}' and 'latest', and pushing to registry..."
    - ${CI_PROJECT_DIR}/build.sh -v "${CI_COMMIT_TAG}" -v "latest" -p
